# ğŸ”§ ModelVS3 è„šæœ¬æ›´æ–°ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ **ä¿®å¤æ¦‚å†µ**

**ä¿®å¤æ—¶é—´**: 2025å¹´8æœˆ4æ—¥  
**ä¿®å¤è„šæœ¬**: `register_all_tools_docker.py`, `restart_dev.sh`  
**çŠ¶æ€**: âœ… å·²å…¨éƒ¨ä¿®å¤å¹¶éªŒè¯é€šè¿‡

---

## ğŸ” **å‘ç°çš„é—®é¢˜**

### **ğŸ”´ register_all_tools_docker.py é—®é¢˜**

| é—®é¢˜ç±»å‹ | åŸå§‹é…ç½® | ä¿®å¤åé…ç½® | çŠ¶æ€ |
|----------|----------|------------|------|
| **æ•°æ®åº“å¯†ç ** | `password` | `ModelVS3_DB_Password_2024` | âœ… å·²ä¿®å¤ |
| **å¼€å‘ç¯å¢ƒç«¯å£** | `postgres:5433` | `postgres:5432` | âœ… å·²ä¿®å¤ |
| **APIæµ‹è¯•åœ°å€** | ä¾èµ–localhost | ä½¿ç”¨Dockerå†…éƒ¨`api:8000` | âœ… å·²ä¿®å¤ |
| **å‰ç«¯URLæ˜¾ç¤º** | ç¡¬ç¼–ç localhost | æ ¹æ®ç¯å¢ƒåŠ¨æ€æ˜¾ç¤º | âœ… å·²ä¿®å¤ |

### **ğŸ”´ restart_dev.sh é—®é¢˜**

| é—®é¢˜ç±»å‹ | åŸå§‹é…ç½® | ä¿®å¤åé…ç½® | çŠ¶æ€ |
|----------|----------|------------|------|
| **ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶** | `docker-compose.yml` | `docker-compose.production.yml` | âœ… å·²ä¿®å¤ |
| **æ•°æ®åº“è¿ç§»** | ä»…å¼€å‘ç¯å¢ƒ | æ‰€æœ‰ç¯å¢ƒéƒ½æ‰§è¡Œ | âœ… å·²ä¿®å¤ |
| **è®¿é—®åœ°å€æ˜¾ç¤º** | æœ¬åœ°åœ°å€ | æ ¹æ®ç¯å¢ƒæ˜¾ç¤ºæ­£ç¡®åœ°å€ | âœ… å·²ä¿®å¤ |
| **ç¯å¢ƒéš”ç¦»** | ä¸å®Œå–„ | å®Œå…¨åŒºåˆ†å¼€å‘/ç”Ÿäº§ | âœ… å·²ä¿®å¤ |

### **ğŸ”´ Dockerfile é—®é¢˜**

| é—®é¢˜ç±»å‹ | åŸå§‹é…ç½® | ä¿®å¤åé…ç½® | çŠ¶æ€ |
|----------|----------|------------|------|
| **scriptsç›®å½•ç¼ºå¤±** | æœªå¤åˆ¶scripts/ | æ·»åŠ `COPY scripts/ ./scripts/` | âœ… å·²ä¿®å¤ |

---

## ğŸ› ï¸ **ä¿®å¤è¯¦æƒ…**

### **1. register_all_tools_docker.py ä¿®å¤**

#### **ä¿®å¤å‰ä»£ç **
```python
def __init__(self, database_url="postgresql://postgres:password@postgres:5432/modelvs3", dev_mode=False):
    if dev_mode:
        database_url = "postgresql://postgres:password@postgres:5433/modelvs3_dev"
```

#### **ä¿®å¤åä»£ç **
```python
def __init__(self, database_url="postgresql://postgres:ModelVS3_DB_Password_2024@postgres:5432/modelvs3", dev_mode=False):
    if dev_mode:
        database_url = "postgresql://postgres:ModelVS3_DB_Password_2024@postgres:5432/modelvs3_dev"
```

### **2. restart_dev.sh ä¿®å¤**

#### **ä¿®å¤å‰ä»£ç **
```bash
2)
    COMPOSE_FILE="docker-compose.yml"
    ENV_NAME="ç”Ÿäº§ç¯å¢ƒ"
```

#### **ä¿®å¤åä»£ç **
```bash
2)
    COMPOSE_FILE="docker-compose.production.yml"
    ENV_NAME="ç”Ÿäº§ç¯å¢ƒ"
```

### **3. Dockerfile ä¿®å¤**

#### **ä¿®å¤å‰ä»£ç **
```dockerfile
# å¤åˆ¶æºä»£ç 
COPY src/ ./src/
COPY qimenEngine/ ./qimenEngine/
COPY alembic.ini .
COPY alembic/ ./alembic/
```

#### **ä¿®å¤åä»£ç **
```dockerfile
# å¤åˆ¶æºä»£ç 
COPY src/ ./src/
COPY qimenEngine/ ./qimenEngine/
COPY scripts/ ./scripts/
COPY alembic.ini .
COPY alembic/ ./alembic/
```

---

## âœ… **éªŒè¯ç»“æœ**

### **ğŸ”§ register_all_tools_docker.py éªŒè¯**
```bash
sudo docker-compose -f docker-compose.production.yml exec api python3 scripts/register_all_tools_docker.py
```

**ç»“æœ**ï¼š
- âœ… æˆåŠŸè¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“
- âœ… æ›´æ–°äº†6ä¸ªå·¥å…·
- âœ… 0ä¸ªå¤±è´¥
- âœ… æ­£ç¡®æ˜¾ç¤ºç”Ÿäº§ç¯å¢ƒè®¿é—®åœ°å€

### **ğŸ”„ restart_dev.sh éªŒè¯**
```bash
./restart_dev.sh
```

**ç»“æœ**ï¼š
- âœ… æ­£ç¡®åŒºåˆ†å¼€å‘/ç”Ÿäº§ç¯å¢ƒ
- âœ… ä½¿ç”¨æ­£ç¡®çš„é…ç½®æ–‡ä»¶
- âœ… æ•°æ®åº“è¿ç§»æ­£å¸¸æ‰§è¡Œ
- âœ… æ˜¾ç¤ºæ­£ç¡®çš„è®¿é—®åœ°å€

---

## ğŸ¯ **æ–°å¢ä¾¿æ·å·¥å…·**

### **register_tools.sh**
åˆ›å»ºäº†æ–°çš„ä¾¿æ·è„šæœ¬ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- **ç¯å¢ƒé€‰æ‹©**: è‡ªåŠ¨åŒºåˆ†å¼€å‘/ç”Ÿäº§ç¯å¢ƒ
- **æœåŠ¡æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
- **æ•°æ®åº“ç­‰å¾…**: æ™ºèƒ½ç­‰å¾…æ•°æ®åº“å°±ç»ª
- **å·¥å…·æ³¨å†Œ**: åœ¨å®¹å™¨å†…æ‰§è¡Œæ³¨å†Œè„šæœ¬
- **ç»“æœå±•ç¤º**: æ˜¾ç¤ºæ­£ç¡®çš„è®¿é—®åœ°å€
- **å¯é€‰æŸ¥çœ‹**: æ”¯æŒæŸ¥çœ‹æ³¨å†Œçš„å·¥å…·åˆ—è¡¨

#### **ä½¿ç”¨æ–¹æ³•**
```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x register_tools.sh

# è¿è¡Œè„šæœ¬
./register_tools.sh
```

---

## ğŸ“Š **ç¯å¢ƒå¯¹æ¯”è¡¨**

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|
| **é…ç½®æ–‡ä»¶** | `docker-compose.dev.yml` | `docker-compose.production.yml` |
| **å‰ç«¯ç«¯å£** | 3004 | 3003 |
| **APIç«¯å£** | 8001 | 8000 |
| **æ•°æ®åº“å** | `modelvs3_dev` | `modelvs3` |
| **å‰ç«¯åœ°å€** | `http://localhost:3004` | `http://36.153.25.22:3003` |
| **APIæ–‡æ¡£** | `http://localhost:8001/docs` | `http://36.153.25.22:3003/docs` |
| **å·¥å…·ç®¡ç†** | `http://localhost:3004/tools` | `http://36.153.25.22:3003/tools` |

---

## ğŸš€ **ä½¿ç”¨æŒ‡å—**

### **å·¥å…·æ³¨å†Œ**

#### **æ–¹æ³•1: ä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
./register_tools.sh
```

#### **æ–¹æ³•2: ç›´æ¥è¿è¡ŒDockerå‘½ä»¤**
```bash
# ç”Ÿäº§ç¯å¢ƒ
sudo docker-compose -f docker-compose.production.yml exec api python3 scripts/register_all_tools_docker.py

# å¼€å‘ç¯å¢ƒ
sudo docker-compose -f docker-compose.dev.yml exec api python3 scripts/register_all_tools_docker.py --dev
```

### **ç¯å¢ƒé‡å¯**

#### **ä½¿ç”¨restart_dev.sh**
```bash
./restart_dev.sh
```
ç„¶åé€‰æ‹©ï¼š
- 1) å¼€å‘ç¯å¢ƒ
- 2) ç”Ÿäº§ç¯å¢ƒ
- 3) åŒæ—¶é‡å¯ä¸¤ä¸ªç¯å¢ƒ

---

## ğŸ‰ **ä¿®å¤æˆæœ**

### **âœ… åŠŸèƒ½éªŒè¯**
- [x] å¼€å‘ç¯å¢ƒå·¥å…·æ³¨å†Œæ­£å¸¸
- [x] ç”Ÿäº§ç¯å¢ƒå·¥å…·æ³¨å†Œæ­£å¸¸
- [x] æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®
- [x] ç¯å¢ƒéš”ç¦»å®Œå–„
- [x] è®¿é—®åœ°å€æ˜¾ç¤ºæ­£ç¡®

### **âœ… å…¼å®¹æ€§éªŒè¯**
- [x] Dockerç¯å¢ƒå…¼å®¹
- [x] å¼€å‘/ç”Ÿäº§ç¯å¢ƒéš”ç¦»
- [x] æ•°æ®åº“è¿ç§»æ­£å¸¸
- [x] å·¥å…·æ›´æ–°æœºåˆ¶æ­£å¸¸

### **âœ… ç”¨æˆ·ä½“éªŒæ”¹è¿›**
- [x] ä¾¿æ·è„šæœ¬ç®€åŒ–æ“ä½œ
- [x] é”™è¯¯æç¤ºæ¸…æ™°
- [x] ç¯å¢ƒé€‰æ‹©å‹å¥½
- [x] è®¿é—®åœ°å€å‡†ç¡®

---

## ğŸ”§ **ç»´æŠ¤è¯´æ˜**

### **å·¥å…·æ³¨å†Œé¢‘ç‡**
- **é¦–æ¬¡éƒ¨ç½²**: å¿…é¡»è¿è¡Œå·¥å…·æ³¨å†Œ
- **ä»£ç æ›´æ–°**: é€šå¸¸ä¸éœ€è¦é‡æ–°æ³¨å†Œ
- **æ–°å¢å·¥å…·**: ä¿®æ”¹è„šæœ¬åéœ€è¦é‡æ–°æ³¨å†Œ
- **æ•°æ®åº“é‡ç½®**: éœ€è¦é‡æ–°æ³¨å†Œæ‰€æœ‰å·¥å…·

### **å¸¸ç”¨å‘½ä»¤**
```bash
# æ£€æŸ¥å·²æ³¨å†Œå·¥å…·
curl -s http://36.153.25.22:3003/api/v1/tools/ | python3 -m json.tool

# æŸ¥çœ‹å·¥å…·æ³¨å†Œæ—¥å¿—
sudo docker-compose -f docker-compose.production.yml logs api

# æ‰‹åŠ¨è¿è¡Œæ•°æ®åº“è¿ç§»
sudo docker-compose -f docker-compose.production.yml exec api alembic upgrade head
```

---

## ğŸ“ **æŠ€æœ¯æ”¯æŒ**

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

1. **æ•°æ®åº“è¿æ¥**: ç¡®è®¤å¯†ç ä¸º `ModelVS3_DB_Password_2024`
2. **DockeræœåŠ¡**: ç¡®è®¤æ‰€æœ‰å®¹å™¨æ­£å¸¸è¿è¡Œ
3. **ç½‘ç»œè¿æ¥**: ç¡®è®¤APIæœåŠ¡å¯ä»¥è®¿é—®æ•°æ®åº“
4. **æƒé™é—®é¢˜**: ç¡®è®¤è„šæœ¬æœ‰æ‰§è¡Œæƒé™

---

**çŠ¶æ€**: ğŸ‰ å…¨éƒ¨ä¿®å¤å®Œæˆï¼Œå¯æ­£å¸¸ä½¿ç”¨  
**ä¸‹æ¬¡æ£€æŸ¥**: å»ºè®®åœ¨ä¸‹æ¬¡ä»£ç æ›´æ–°åéªŒè¯è„šæœ¬åŠŸèƒ½