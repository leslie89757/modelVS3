# æŠ€æœ¯å€ºåŠ¡ä¿®å¤æ€»ç»“

## ğŸ¯ ä¿®å¤æ¦‚è§ˆ

æœ¬æ¬¡æŠ€æœ¯å€ºåŠ¡ä¿®å¤ä¸»è¦è§£å†³äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### âœ… å·²å®Œæˆçš„ä¿®å¤

#### 1. **APIè®¤è¯ç»Ÿä¸€åŒ–** (é«˜ä¼˜å…ˆçº§)
- **é—®é¢˜**: ä»£ç ä¸­æ··åˆä½¿ç”¨ç›´æ¥`localStorage.getItem('token')`å’Œè®¤è¯ä¸Šä¸‹æ–‡
- **è§£å†³æ–¹æ¡ˆ**: 
  - åˆ›å»ºäº†ç»Ÿä¸€çš„`useApi` hook (`frontend/src/hooks/useApi.ts`)
  - ä¿®å¤äº†æ‰€æœ‰ç»„ä»¶çš„APIè°ƒç”¨æ–¹å¼
  - è‡ªåŠ¨å¤„ç†tokenæ³¨å…¥ã€è¿‡æœŸæ£€æµ‹å’Œé”™è¯¯å¤„ç†

**ä¿®å¤çš„æ–‡ä»¶:**
- `frontend/src/pages/Agents.tsx` - Agentç®¡ç†é¡µé¢
- `frontend/src/pages/AgentMarketplace.tsx` - Agentå¸‚åœºé¡µé¢  
- `frontend/src/components/MobileAgentChat.tsx` - ç§»åŠ¨ç«¯èŠå¤©ç»„ä»¶

**ä¿®å¤å‰:**
```typescript
// âŒ é—®é¢˜ä»£ç 
const response = await fetch('/api/v1/agents/publish', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`,
  }
})
```

**ä¿®å¤å:**
```typescript
// âœ… æ­£ç¡®ä»£ç 
const api = useApi()
const response = await api.post('/api/v1/agents/publish', {})
```

#### 2. **é”™è¯¯è¾¹ç•Œå¤„ç†** (ä¸­ä¼˜å…ˆçº§)
- **é—®é¢˜**: ç¼ºå°‘å…¨å±€é”™è¯¯æ•è·æœºåˆ¶
- **è§£å†³æ–¹æ¡ˆ**:
  - åˆ›å»ºäº†`ErrorBoundary`ç»„ä»¶ (`frontend/src/components/ErrorBoundary.tsx`)
  - é›†æˆåˆ°Appæ ¹ç»„ä»¶ä¸­
  - æ”¯æŒå¼€å‘æ¨¡å¼çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
  - æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ç•Œé¢

**ç‰¹æ€§:**
- è‡ªåŠ¨é”™è¯¯æŠ¥å‘Š(æ”¯æŒGoogle Analytics)
- ä¼˜é›…çš„é™çº§UI
- é‡æ–°åŠ è½½/è¿”å›é¦–é¡µåŠŸèƒ½
- å¼€å‘æ¨¡å¼ä¸‹çš„è¯¦ç»†å †æ ˆä¿¡æ¯

#### 3. **æ€§èƒ½ä¼˜åŒ–** (ä¸­ä¼˜å…ˆçº§)
- **é—®é¢˜**: ç¼ºå°‘æ€§èƒ½ä¼˜åŒ–å·¥å…·å’Œç»„ä»¶
- **è§£å†³æ–¹æ¡ˆ**:
  - åˆ›å»ºäº†`useDebounce` hook - é˜²æŠ–æœç´¢å’ŒAPIè°ƒç”¨
  - åˆ›å»ºäº†`useLocalStorage` hook - å®‰å…¨çš„æœ¬åœ°å­˜å‚¨ç®¡ç†
  - åˆ›å»ºäº†`LazyImage`ç»„ä»¶ - å›¾ç‰‡æ‡’åŠ è½½ä¼˜åŒ–

**æ–°å¢çš„ä¼˜åŒ–å·¥å…·:**
```typescript
// é˜²æŠ–æœç´¢
const debouncedSearchTerm = useDebounce(searchTerm, 300)

// å®‰å…¨çš„æœ¬åœ°å­˜å‚¨
const [settings, setSettings] = useLocalStorage('userSettings', defaultSettings)

// æ‡’åŠ è½½å›¾ç‰‡
<LazyImage src="/avatar.jpg" alt="ç”¨æˆ·å¤´åƒ" />
```

#### 4. **TypeScriptç±»å‹å®‰å…¨** (ä¸­ä¼˜å…ˆçº§)
- **é—®é¢˜**: ç¼ºå°‘ç»Ÿä¸€çš„ç±»å‹å®šä¹‰ï¼Œå­˜åœ¨ç±»å‹é”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**:
  - åˆ›å»ºäº†å…¨å±€ç±»å‹å®šä¹‰æ–‡ä»¶ (`frontend/src/types/global.d.ts`)
  - ä¿®å¤äº†æ‰€æœ‰TypeScripté”™è¯¯
  - ç»Ÿä¸€äº†APIå“åº”ç±»å‹

**æ–°å¢ç±»å‹:**
- `ApiResponse<T>` - ç»Ÿä¸€APIå“åº”æ ¼å¼
- `Agent`, `User`, `Model`, `Tool` - æ ¸å¿ƒä¸šåŠ¡ç±»å‹
- `FormErrors<T>` - è¡¨å•é”™è¯¯ç±»å‹
- æ‰©å±•äº†Windowå’ŒImportMetaæ¥å£

## ğŸ—ï¸ æ–°å¢çš„åŸºç¡€è®¾æ–½

### 1. **useApi Hook**
ç»Ÿä¸€çš„APIè°ƒç”¨ç®¡ç†å™¨ï¼Œè‡ªåŠ¨å¤„ç†ï¼š
- JWT tokenæ³¨å…¥
- 401é”™è¯¯è‡ªåŠ¨ç™»å‡º
- é”™è¯¯æ¶ˆæ¯ç»Ÿä¸€æ˜¾ç¤º
- ç½‘ç»œé”™è¯¯å¤„ç†

### 2. **ErrorBoundaryç»„ä»¶**
Reacté”™è¯¯è¾¹ç•Œï¼Œæä¾›ï¼š
- JavaScripté”™è¯¯æ•è·
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯ç•Œé¢
- å¼€å‘æ¨¡å¼è°ƒè¯•ä¿¡æ¯
- é”™è¯¯ç›‘æ§é›†æˆ

### 3. **æ€§èƒ½ä¼˜åŒ–Hooks**
- `useDebounce` - é˜²æŠ–å¤„ç†
- `useLocalStorage` - æœ¬åœ°å­˜å‚¨ç®¡ç†
- `useDebouncedCallback` - é˜²æŠ–å›è°ƒ

### 4. **æ‡’åŠ è½½ç»„ä»¶**
- `LazyImage` - é€šç”¨å›¾ç‰‡æ‡’åŠ è½½
- `LazyAvatar` - å¤´åƒä¸“ç”¨æ‡’åŠ è½½

## ğŸ“Š æŠ€æœ¯å€ºåŠ¡ä¿®å¤å‰åå¯¹æ¯”

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **APIè°ƒç”¨** | ä¸ä¸€è‡´ï¼Œæ‰‹åŠ¨å¤„ç†è®¤è¯ | ç»Ÿä¸€useApi hookï¼Œè‡ªåŠ¨è®¤è¯ |
| **é”™è¯¯å¤„ç†** | åˆ†æ•£çš„try-catch | ç»Ÿä¸€é”™è¯¯è¾¹ç•Œ+è‡ªåŠ¨å¤„ç† |
| **ç±»å‹å®‰å…¨** | éƒ¨åˆ†anyç±»å‹ | å®Œæ•´TypeScriptç±»å‹å®šä¹‰ |
| **æ€§èƒ½** | æ— ä¼˜åŒ–æœºåˆ¶ | é˜²æŠ–ã€æ‡’åŠ è½½ã€æœ¬åœ°å­˜å‚¨ |
| **ç”¨æˆ·ä½“éªŒ** | é”™è¯¯æ—¶ç™½å± | ä¼˜é›…çš„é”™è¯¯ç•Œé¢ |
| **å¼€å‘ä½“éªŒ** | è°ƒè¯•å›°éš¾ | è¯¦ç»†é”™è¯¯ä¿¡æ¯+ç±»å‹æç¤º |

## ğŸ‰ ä¿®å¤æˆæœ

### âœ… è§£å†³çš„é—®é¢˜
1. **æ¶ˆé™¤äº†æ‰€æœ‰ç›´æ¥ä½¿ç”¨localStorageçš„è®¤è¯é—®é¢˜**
2. **ç»Ÿä¸€äº†é”™è¯¯å¤„ç†æœºåˆ¶**
3. **æå‡äº†åº”ç”¨ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ**
4. **å¢å¼ºäº†TypeScriptç±»å‹å®‰å…¨**
5. **æ·»åŠ äº†æ€§èƒ½ä¼˜åŒ–åŸºç¡€è®¾æ–½**

### ğŸš€ å¸¦æ¥çš„æ”¹è¿›
- **å¼€å‘æ•ˆç‡æå‡**: ç»Ÿä¸€çš„APIè°ƒç”¨æ–¹å¼ï¼Œå‡å°‘é‡å¤ä»£ç 
- **ç”¨æˆ·ä½“éªŒæ”¹å–„**: æ›´å¥½çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½ä¼˜åŒ–
- **ä»£ç è´¨é‡æå‡**: å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæœ€ä½³å®è·µ
- **ç»´æŠ¤æ€§å¢å¼º**: æ¸…æ™°çš„æ¶æ„å’Œé”™è¯¯è¾¹ç•Œ

## ğŸ“ ä½¿ç”¨æŒ‡å—

### åœ¨æ–°ç»„ä»¶ä¸­ä½¿ç”¨useApi
```typescript
import { useApi } from '../hooks/useApi'

function MyComponent() {
  const api = useApi()
  
  const fetchData = async () => {
    try {
      const response = await api.get('/api/v1/data')
      const data = await response.json()
      // å¤„ç†æ•°æ®
    } catch (error) {
      // é”™è¯¯å·²è‡ªåŠ¨å¤„ç†ï¼Œåªéœ€è¦è®°å½•æ—¥å¿—
      console.error('è·å–æ•°æ®å¤±è´¥:', error)
    }
  }
}
```

### æ·»åŠ é”™è¯¯è¾¹ç•Œåˆ°æ–°é¡µé¢
```typescript
import ErrorBoundary from '../components/ErrorBoundary'

function MyPage() {
  return (
    <ErrorBoundary>
      <MyComponent />
    </ErrorBoundary>
  )
}
```

### ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–Hooks
```typescript
import { useDebounce, useLocalStorage } from '../hooks'

function SearchComponent() {
  const [searchTerm, setSearchTerm] = useState('')
  const [settings, setSettings] = useLocalStorage('searchSettings', {})
  const debouncedSearch = useDebounce(searchTerm, 300)
  
  // debouncedSearch ä¼šåœ¨ç”¨æˆ·åœæ­¢è¾“å…¥300msåæ›´æ–°
}
```

## ğŸ”® åç»­æ”¹è¿›å»ºè®®

1. **æ·»åŠ å•å…ƒæµ‹è¯•**: ä¸ºæ–°çš„hookså’Œç»„ä»¶æ·»åŠ æµ‹è¯•ç”¨ä¾‹
2. **æ€§èƒ½ç›‘æ§**: é›†æˆçœŸå®ç”¨æˆ·ç›‘æ§(RUM)
3. **ç¼“å­˜ä¼˜åŒ–**: æ·»åŠ React Queryæˆ–SWRè¿›è¡Œæ•°æ®ç¼“å­˜
4. **ä»£ç åˆ†å‰²**: å®ç°è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²
5. **é”™è¯¯ç›‘æ§**: é›†æˆSentryç­‰é”™è¯¯ç›‘æ§æœåŠ¡

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2024å¹´1æœˆ
**ä¿®å¤äººå‘˜**: AI Assistant  
**å½±å“èŒƒå›´**: å‰ç«¯åº”ç”¨å…¨å±€
**é£é™©è¯„ä¼°**: ä½é£é™©ï¼ˆå‘åå…¼å®¹ï¼Œæ¸è¿›å¼æ”¹è¿›ï¼‰ 